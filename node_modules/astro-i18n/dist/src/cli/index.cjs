#!/usr/bin/env node
"use strict";var he=Object.create;var on=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var xe=Object.getOwnPropertyNames;var Ae=Object.getPrototypeOf,$e=Object.prototype.hasOwnProperty;var Ce=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of xe(t))!$e.call(n,o)&&o!==e&&on(n,o,{get:()=>t[o],enumerable:!(r=Te(t,o))||r.enumerable});return n};var Re=(n,t,e)=>(e=n!=null?he(Ae(n)):{},Ce(t||!n||!n.__esModule?on(e,"default",{value:n,enumerable:!0}):e,n));var St=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var x=(n,t,e)=>(St(n,t,"read from private field"),e?e.call(n):t.get(n)),w=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},Y=(n,t,e,r)=>(St(n,t,"write to private field"),r?r.call(n,e):t.set(n,e),e);var Z=(n,t,e)=>(St(n,t,"access private method"),e);var Nt="default",sn="argv.main",_,ft,an,ct,fn,Lt=class{constructor(t=[]){w(this,ft);w(this,ct);this.command=Nt;this.args=[];this.options={};w(this,_,{});let[e,r]=process.argv;this.node=e??"",this.file=r??"",Z(this,ft,an).call(this,t),Z(this,ct,fn).call(this,process.argv.slice(2),t.length===1&&t[0].name===Nt)}};_=new WeakMap,ft=new WeakSet,an=function(t){for(let e of t){x(this,_)[e.name]||(x(this,_)[e.name]={});for(let r of e.options)x(this,_)[e.name][`--${r.name}`]=r.name,r.shortcut&&(x(this,_)[e.name][`-${r.shortcut}`]=r.name)}},ct=new WeakSet,fn=function(t,e=!1){var i;if(t.length===0)return;let r=t;e?this.command=Nt:(this.command=t.at(0),r=t.slice(1));let o=sn;for(let s of r){let a=x(this,_)[this.command][s];if(!a)s.startsWith("--")&&(a=s.replace("--","")),s.startsWith("-")&&(a=s.replace("-",""));else{this.options[a]=[],o=a;continue}if(o===sn){this.args.push(s);continue}(i=this.options[o])==null||i.push(s)}};function Dt(n=[]){return new Lt(n)}var it=require("path");var A=require("fs"),D=require("path");function F(n){try{return JSON.parse((0,A.readFileSync)(n,"utf8"))}catch{return}}function H(n,t,e=[]){try{let r=(0,A.readdirSync)(n);for(let o=0;o<r.length;o+=1){let i=(0,D.join)(n,r[o]);e.some(s=>s.test(i))?(r.splice(o,1),o-=1):$(i,!1)&&H(i,t)}t(r,n)}catch{}}function $(n,t=!0){return t?(0,A.existsSync)(n)&&(0,A.lstatSync)(n).isDirectory():(0,A.lstatSync)(n).isDirectory()}function R(n,t=!0){return t?(0,A.existsSync)(n)&&!(0,A.lstatSync)(n).isDirectory():!(0,A.lstatSync)(n).isDirectory()}function B(...n){let t=(0,D.join)(...n);if(!(0,A.existsSync)(t))throw new ReferenceError(`Path: ${t} doesn't exist.`);return t}function Ft(n){return n.endsWith(D.sep)?n.slice(0,-1):n}function cn(n){return n.startsWith(D.sep)?n.slice(1):n}function p(n,t,e){let r=Ft(n).split(D.sep),o=r.pop()||"",i=r.join(D.sep);(0,A.mkdirSync)(i,{recursive:!0}),(0,A.writeFileSync)((0,D.join)(i,o),t,{encoding:"utf8",flag:e})}function un(n){let t=n.lastIndexOf(".");return t<0?[n,""]:[n.slice(0,t),n.slice(t+1)]}function U(n){let t=n.lastIndexOf(".");return t<0?"":n.slice(t+1).toLowerCase()}function ut(n){let t=n.lastIndexOf(".");return t<0?n:n.slice(0,t)}function pn(n){let t=n.lastIndexOf(".");return t<0?[n,""]:[n.slice(0,t),n.slice(t+1)]}function E(n){return Object.getPrototypeOf(n)===Object.prototype}function pt(n){return Array.isArray(n)&&n.every(t=>typeof t=="string")}function ln(n){if(!E(n))return!1;for(let t of Object.values(n))if(typeof t!="string")return!1;return!0}function gn(n){if(!E(n))throw new Error(`"${n}" is not of type Record<string, string>.`);for(let t of Object.values(n))if(typeof t!="string")throw new TypeError(`"${t}" is not of type string.`)}function jt(n,t){if(!n.includes(t))throw new Error(`${t} is not in [${n.join(", ")}].`)}function P(n){return Object.entries(n)}function lt(n){let t=typeof n;if(t==="bigint")return"number";if(t==="function")return"(...args: unknown[]) => unknown";if(t!=="object")return t;if(!n)return"null";if(Array.isArray(n))return n.length===0?"unknown[]":`(${[...new Set(n.map(r=>lt(r)))].join(" | ")})[]`;if(E(n)){let e=Object.entries(n).map(([r,o])=>`"${r}": ${lt(o)}`);return e.length===0?"Record<string, unknown>":`{ ${e.join(", ")} }`}return"unknown"}function mn(n,t,e){let r=n;for(let[o,i]of t.entries()){if(o===t.length-1){r[i]=e;break}if(!dn(r,i)){r[i]={},r=r[i];continue}if(Object.getPrototypeOf(r[i])===Object.prototype){r=r[i];continue}break}}function y(n,t,e){let{mode:r,modifyBase:o}={mode:"replace",modifyBase:!0,...e},i=o?n:_t(n);for(let[s,a]of P(t)){let f=i[s];if(dn(i,s)){E(f)&&E(a)?y(f,a):r==="replace"&&(i[s]=t[s]);continue}i[s]=t[s]}return i}function _t(n){return!n||typeof n!="object"?n:Array.isArray(n)?n.map(t=>typeof t=="object"?_t(t):t):P(n).reduce((t,[e,r])=>{let o=t;return o[e]=_t(r),t},{})}function dn(n,t){return Object.prototype.hasOwnProperty.call(n,t)}var l="astro.i18n.config",j=".astro",q="i18n",X="{route}",h="astro-i18n",yn="tsconfig.json",gt=".",k=`.${h}`,mt="generated.d.ts",hn="generated.keys.json",Tn="env.d.ts",dt="astro.config",yt="i18n",xn="package.json",An="deno.json",$n="deno.jsonc",Cn=":",bt="|",Rn=",",En=":";function S(){return new Error("Cannot resolve astro's working directory.")}function N(n){return new Error(`Cannot resolve astro's working directory. 
Make sure that "${n}" exists.`)}function On(n){let t=Object.keys(n).map(e=>`${h} ${e}`);throw new Error(`Command not found, available commands : ${t.join(`
`)}`)}var Sn=Re(require("get-file-exports")),Nn=require("fs"),Ln=require("path");function In(n){if(!E(n))throw new TypeError(`${l} is not an object literal.`);if(n.defaultLangCode&&typeof n.defaultLangCode!="string")throw new TypeError(`${l}.defaultLangCode must be of type string.`);if(n.supportedLangCodes&&!pt(n.supportedLangCodes))throw new TypeError(`${l}.supportedLangCodes must be an array of strings.`);if(n.showDefaultLangCode!==void 0&&typeof n.showDefaultLangCode!="boolean")throw new TypeError(`${l}.showDefaultLangCode must be of type boolean.`);if(n.trailingSlash!==void 0&&!(n.trailingSlash=="always"||n.trailingSlash=="never"))throw new TypeError(`${l}.trailingSlash must be "always" or "never".`);n.translations&&Ee(n.translations,n.defaultLangCode,n.supportedLangCodes),n.routeTranslations&&Oe(n.routeTranslations,n.defaultLangCode)}function Ee(n,t,e){if(!E(n))throw new TypeError(`${l}.translations must be an object literal.`);let r=[];typeof t=="string"&&r.push(t),pt(e)&&r.push(...e);for(let[o,i]of Object.entries(n)){if(r.length>0&&!r.includes(o))throw new TypeError(`${l}.translations.${o}, unsupported lang code.
Add "${o}" to ${l}.supportedLangCodes or ${l}.defaultLangCode).`);if(typeof i!="string"){if(!E(i))throw new TypeError(`${l}.translations.${o} must be either a translation object or a (string) path to a json one.`);for(let[,s]of Object.entries(i))wn(s)}}}function Oe(n,t){if(!E(n))throw new TypeError(`${l}.routeTranslations must be an object literal.`);let e=[];pt(t)&&e.push(...t);for(let[r,o]of Object.entries(n)){if(e.length>0&&!e.includes(r))throw new TypeError(`${l}.routeTranslations.${r}, unsupported lang code.
Add "${r}" to ${l}.supportedLangCodes).`);if(typeof o!="string"&&!ln(o))throw new TypeError(`${l}.routeTranslations.${r} must be either a Record<string, string> or a (string) path to a json one.`)}}function Q(n){if(typeof n=="string")return!0;if(!E(n))return!1;for(let t of Object.values(n))if(!Q(t))return!1;return!0}function wn(n){if(typeof n!="string"){if(!E(n))throw new TypeError(`"${n}" must be either a string or a translation object.`);for(let t of Object.values(n))wn(t)}}var Pn=new Set(["json","js","cjs","mjs","ts","cts","mts"]),Ie={defaultLangCode:"en",supportedLangCodes:[],showDefaultLangCode:!1,trailingSlash:"never",translations:{},routeTranslations:{}};function vt(){return{...Ie}}async function V(n,t=""){let e=we(n,t),r=e.endsWith(".json")?F(e):(await(0,Sn.default)(e)).default;return In(r),Pe(r,n)}function we(n,t=""){if(t){if(!R(t))throw new Error(`${t} is not an astro-i18n config file.`);let e=U(t);if(!Pn.has(e))throw new Error(`The astro-i18n config file must be a JavaScript or TypeScript file (found "${e}").`);return t}if(!$(n))throw new Error(`${n} is not the project's root directory.`);for(let e of(0,Nn.readdirSync)(n)){let[r,o]=pn(e);if(!!Pn.has(o)&&r===l)return(0,Ln.join)(n,e)}throw new Error(`Could not resolve the astro-i18n config file, verify that you have a ${l}<.js/.ts> file in your project root directory "${n}".`)}function Pe({defaultLangCode:n,supportedLangCodes:t,showDefaultLangCode:e,trailingSlash:r,translations:o,routeTranslations:i}={},s=""){let a=vt();if(n&&(a.defaultLangCode=n),t&&(a.supportedLangCodes=t),e!==void 0&&(a.showDefaultLangCode=e),r&&(a.trailingSlash=r),s){let f=[a.defaultLangCode,...a.supportedLangCodes];o&&(a.translations=Se(o,f,s)),i&&(a.routeTranslations=Ne(i,f,s))}for(let f of a.supportedLangCodes)a.routeTranslations[f]||(a.routeTranslations[f]={});for(let f of[a.defaultLangCode,...a.supportedLangCodes])a.translations[f]||(a.translations[f]={});return a}function Se(n,t,e){let r={};for(let[o,i]of P(n))if(jt(t,o),typeof i=="string"){let s=B(e,i),a=F(s);if(!a)throw new Error(`Failed to load astroI18nConfig.translations.${o} (${s}), make sure that it's valid JSON.`);if(!Q(a)||typeof a=="string")throw new TypeError(`astroI18nConfig.translations.${o} is not a valid translation object.`);r[o]=a}else r[o]=i;return r}function Ne(n,t,e){let r={};for(let[o,i]of P(n))if(jt(t,o),typeof i=="string"){let s=B(e,i),a=F(s);if(!a)throw new Error(`Failed to load astroI18nConfig.routeTranslation.${o} (${s}), make sure that it's valid JSON.`);gn(a),r[o]=a}else r[o]=i;return r}function ht(n,t,e=!1){return[n.slice(0,t),n.slice(t+Number(e))]}function Dn(n,t){let e=n.indexOf(t);return e<0?["",n]:ht(n,e+t.length)}function Fn(n,t,e){let r=n.endsWith(t)?n.slice(0,-t.length):n,o=e.startsWith(t)?e.slice(t.length):e;return`${r}${t}${o}`}function Tt(n,t){return n.startsWith(t)?n.slice(t.length):n}function tt(n,t){return n.endsWith(t)?n.slice(0,-t.length):n}function L(n,t){let e=n.exec(t);if(!e)return null;let r={range:[e.index,e.index+e[0].length],match:[...e]};return n.lastIndex=0,r}function Mt(n,t,e,r){return`${n.slice(0,t)}${r}${n.slice(e)}`}function Ut(n,t){if(!n.flags.includes("g"))throw new Error(`Cannot exec over \`/${n.source}/\` without the "g" flag.`);let e=[],r;for(;r!==null;)(r==null?void 0:r.index)!==void 0&&e.push({range:[r.index,r.index+r[0].length],match:[...r]}),r=n.exec(t);return e}var lo=new Set("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_");function jn(n){if(typeof n=="number")return n;if(typeof n=="string"){let t=Number.parseFloat(n);if(!Number.isNaN(t))return t}}function _n(n){let t=typeof n=="string"||typeof n=="number"?new Date(n):n;if(t instanceof Date&&!Number.isNaN(t.getTime()))return t}function xt(n,{defaultLangCode:t,supportedLangCodes:e}){if(n.startsWith("/"))for(let r of[t,...e]){let o=new RegExp(`^/${r}(/)?`);if(o.test(n))return n.replace(o,"/")}else for(let r of[t,...e]){let o=new RegExp(`^${r}(/)?`);if(o.test(n))return n.replace(o,"")}return n}function bn(n,t){var e;return(e=n.match(new RegExp(`/?(${t.join("|")})(?:/.*)?$`)))==null?void 0:e[1]}var kt=/{([\dA-Za-z]+:[^}]+)}/g,Le=/{([\dA-Za-z]+)(:[^|}]+)?(|[^}]+)}/g,vn=/[\dA-Za-z]+/,De=/^["'].+["']$/,Fe=/^-? ?\d+(.\d+)?$/;function Mn(n){let t=je(n);return t?{name:n.replace(kt,""),variant:t}:{name:n,variant:{name:n,properties:[]}}}function je(n){let t=L(kt,n);if(!t)return;let{match:e}=t;if(!e[1])return;let r=[];for(let o of e[1].split(Rn)){let[i,s]=o.split(En).map(f=>f.trim());if(i===o||!vn.test(i))continue;let a=Vt(s);typeof a!="string"&&typeof a!="number"||r.push({name:i,value:a})}return{name:n,properties:r}}function Un(n){let t=[],e=n.matchAll(Le);for(let r of e){let o=_e(r);o&&t.push(o)}return t.sort((r,o)=>o.range[1]-r.range[1])}function _e(n){if(n.index===void 0)return;let t={name:"",default:void 0,formatters:[],range:[n.index,n.index+n[0].length]};for(let e=1;e<n.length;e+=1)!n[e]||(e===1&&(t.name=n[e]),e===2&&(t.default=be(n[e])),e===3&&(t.formatters=ve(n[e])));if(t.name)return t}function be(n){if(n[0]===Cn)return Vt(n.slice(1))}function ve(n){return n[0]!==bt?[]:n.split(bt).filter(t=>!!t).map(t=>{if(!/[\dA-Za-z]+\(.+\)/.test(t))return{name:t,arguments:[]};let e=t.indexOf("(");return{name:t.slice(0,e),arguments:t.slice(e+1,t.lastIndexOf(")")).split(",").map(o=>Me(o.trim()))}})}function Me(n){let t=Vt(n,!1);return t&&typeof t=="object"&&vn.test(n)?{getter:e=>e==null?void 0:e[t.name],name:t.name}:{getter:()=>t}}function Vt(n,t=!0){if(n==="null")return null;if(n==="undefined")return;if(n==="true")return!0;if(n==="false")return!1;let e=n.match(De);if(e)return e[0].slice(1).slice(0,-1);if(e=n.match(Fe),e)return Number.parseFloat(e[0].replace(" ",""));if(t)throw new Error(`Could not parse "${n}" (not a primitive).`);return{name:n}}function kn(n){let t={},e=new Set;return nt(n,(r,{variant:o})=>{if(!o)return;let i=Ue(r,o);e.has(i)||(t[r]||(t[r]=[]),t[r].push(o),e.add(i))}),t}function Ue(n,t){let e=n.lastIndexOf(gt);return e<0?t.name:`${n.slice(0,e)}${gt}${t.name}`}function nt(n,t,e){let{path:r,first:o}={path:"",first:!0,...e};for(let[i,s]of P(n)){let a=Mn(i);if(typeof s=="string"){t(`${r}${a.name}`,a,Un(s));continue}if(o){nt(s,t,{path:"",first:!1});continue}nt(s,t,{path:`${r}${a.name}${gt}`,first:!1})}}var G,z,b,v,At,Vn,Gt=class{constructor(){w(this,At);w(this,G,{});w(this,z,{});w(this,b,void 0);w(this,v,{number:(t,e={},r=x(this,b))=>{if(typeof r!="string"||typeof e!="object"||!e)return String(t);let o=jn(t);return o===void 0?String(t):new Intl.NumberFormat(r,e).format(o)},date:(t,e={},r=x(this,b))=>{if(typeof r!="string"||typeof e!="object"||!e)return String(t);let o=_n(t);return o===void 0?String(t):new Intl.DateTimeFormat(r,e).format(o)}});let t=vt();this.defaultLangCode=t.defaultLangCode,this.supportedLangCodes=t.supportedLangCodes,this.showDefaultLangCode=t.showDefaultLangCode,this.trailingSlash=t.trailingSlash,this.translations=t.translations,this.routeTranslations=t.routeTranslations,Y(this,b,this.defaultLangCode)}get langCodes(){return[this.defaultLangCode,...this.supportedLangCodes]}get langCode(){return x(this,b)}set langCode(t){if(!this.langCodes.includes(t))throw new Error(`Cannot set langCode to "${t}". "${t}" is not not supported, did you add it to the astro-i18n config file ?`);Y(this,b,t)}get formatters(){return x(this,v)}internals(){return{init:Z(this,At,Vn).bind(this),translationVariants:x(this,z),fullRouteTranslations:x(this,G)}}addTranslations(t){let e=kn(t);y(this.translations,t),y(x(this,z),e)}addRouteTranslations(t){let e=Gn({...this,routeTranslations:t});y(this.routeTranslations,t),y(x(this,G),e)}getFormatter(t){return x(this,v)[t]}setFormatter(t,e){x(this,v)[t]=e}deleteFormatter(t){delete x(this,v)[t]}init(t,e){let r=bn(t.url.pathname,this.langCodes);if(r&&!this.langCodes.includes(r)&&(r=this.defaultLangCode),this.langCode=r||this.defaultLangCode,e)for(let[o,i]of Object.entries(e))this.setFormatter(o,i)}};G=new WeakMap,z=new WeakMap,b=new WeakMap,v=new WeakMap,At=new WeakSet,Vn=function(t,e={},r={}){for(let[o,i]of P(t))this[o]!==void 0&&(this[o]=i);Y(this,G,r),Y(this,z,e)};var Fo=new Gt;function $t(n,t,{defaultLangCode:e,supportedLangCodes:r,showDefaultLangCode:o,routeTranslations:i},s="/",a=""){let[f,c]=Dn(n.toLowerCase(),a.toLowerCase());if(!c)return n||s;let u=Tt(c,s).split(s);[e,...r].includes(u[0])&&u.shift();let g=u.at(-1)||"",T=!1;g.endsWith(j)&&g!==`index${j}`&&(u[u.length-1]=g.replace(j,""),T=!0),(o||t!==e)&&u.unshift(t);let m=Fn(f,s,u.map(d=>{var M;return(M=i[t])!=null&&M[d]?i[t][d]:d}).join(s));return T?tt(`${m}${j}`,s)||s:tt(m,s)||s}function Gn({defaultLangCode:n,routeTranslations:t}){let e={[n]:{}},r=Object.entries(t).filter(([o])=>o!==n);for(let[o,i]of r){e[o]={};let s=r.filter(([a])=>a!==o);for(let[a,f]of Object.entries(i)){e[n][a]||(e[n][a]={}),e[n][a][o]=f,e[o][f]={[n]:a};for(let[c,u]of s)u[a]&&(e[o][f][c]=u[a])}}return e}var K=require("path");function Ct(n,t,e,r,o){let i=Math.max(0,cn(Ft(e)).split(K.sep).length-1),s=`"${K.posix.join("../".repeat(i),t.replaceAll("\\","/"))}"
`,a=`---
import Page from ${s}`;r&&(a+=Ve(s)),o&&(a+=`export const prerender = true

`),a+=`const { props } = Astro
---

<Page {...props} />`,p((0,K.join)(n,e),a)}function Ve(n){return`import { getStaticPaths as proxyGetStaticPaths } from ${n}import { extractRouteLangCode } from "${h}"

/* @ts-ignore */
export const getStaticPaths = (props) => proxyGetStaticPaths({
	...props,
	langCode: extractRouteLangCode(import.meta.url),
})

`}var Zt=require("path");var et=require("fs"),C=require("path");function Rt(n){let t=(0,C.join)(n,yn);return R(t)}function zt(){return(0,C.join)(k,mt)}function I(){return(0,C.join)("src","pages")}function Kn(){return(0,C.join)("src",Tn)}function J(n,t){let{defaultLangCode:e,supportedLangCodes:r}=t,o=B(n,I()),i={},s=zn([e,...r]),a=zn(r),f=Ze(o,t);return H(o,(c,u)=>{for(let g of c){let T=(0,C.join)(u,g),m=T.replace(o,""),d=$(T)?Je(m):ze(m);if(!d)continue;let M=Ke(m);if(i[d]||(i[d]={name:M,route:d,path:"",hasGetStaticPaths:!1,hasPrerender:!1}),T.endsWith(j))i[d].path=m,i[d].hasGetStaticPaths=We(T),i[d].hasPrerender=Ye(T),i[d].name=M;else{let{pageTranslations:de,pageRouteTranslations:ye}=Ge(T,d,M,t);y(s,de),y(a,ye)}}},f),{directory:o,pages:Object.values(i).filter(c=>!!c.path),translations:s,routeTranslations:a}}function Ge(n,t,e,{defaultLangCode:r,supportedLangCodes:o}){let i={},s={},a=new Set([r,...o]);for(let f of(0,et.readdirSync)(n)){let[c,u]=un(f);if(u!=="json"||!a.has(c))continue;let g=F((0,C.join)(n,f));if(typeof g=="string"||!Q(g))continue;g[X]!==void 0&&(typeof g[X]=="string"&&mn(s,[c,e],g[X]),delete g[X]);let T=g,m=["index",...t.split("/").filter(d=>!!d)];for(let d=m.length-1;d>-1;d-=1)T={[m[d]]:T};i[c]=T}return{pageTranslations:i,pageRouteTranslations:s}}function ze(n){let t=n.split(C.sep),e=t.at(-1)??"",r=e.lastIndexOf(".");if(r<0)return;let[o,i]=ht(e,r);if(i===j)return o==="index"?t.pop():t[t.length-1]=o,t.join("/")||"/"}function Ke(n){let t=n.split(C.sep);return t.at(-1)===`index${j}`||t.at(-1)===q?t.at(-2)||"index":ut(t.at(-1)||"unknown")}function Je(n){let t=n.split(C.sep),e=t.at(-1)??"";e===q&&(e=`index.${q}`);let r=e.lastIndexOf(".");if(r<0)return;let[o,i]=ht(e,r,!0);if(i===q)return o==="index"?t.pop():t[t.length-1]=o,t.join("/")||"/"}function We(n){try{let t=(0,et.readFileSync)(n,"utf8");return["export function getStaticPaths","export async function getStaticPaths","export const getStaticPaths","export { getStaticPaths }","export {getStaticPaths}"].some(e=>t.includes(e))}catch{return!1}}function Ye(n){try{let t=(0,et.readFileSync)(n,"utf8");return["export const prerender","export let prerender","export var prerender","export { prerender }","export {prerender}"].some(e=>t.includes(e))}catch{return!1}}function Ze(n,{showDefaultLangCode:t,defaultLangCode:e,supportedLangCodes:r}){let o;return t?o=[He(e,n)]:o=[...r,e].map(s=>Be(s,n)),o}function He(n,t=""){let e=C.sep==="/"?C.sep:"\\\\",r=t;return r.at(-1)!==C.sep&&(r=`${r}${e}`),new RegExp(`${r}(?!(${n}$)|(${n}${e}(.+)?))`)}function Be(n,t=""){let e=C.sep==="/"?C.sep:"\\\\",r=t;return r.at(-1)!==C.sep&&(r=`${r}${e}`),new RegExp(`${r}(?=(${n}$)|(${n}${e}(.+)?))`)}function zn(n){let t={};for(let e of n)t[e]={};return t}var Et="DefaultLangCode",Ot="SupportedLangCode",O="LangCode",qe="l",Wn="RouteUri",Yt="RouteParams",Xe="t",Yn="TranslationPath",ot="TranslationOptions",Qe="AstroI18n",Kt="Translation",Jt="Translations",Wt="RouteTranslations",rt="InterpolationFormatter",Jn=`declare module "${h}" {
	export * from "${h}/"
}`,tr=`declare module "${h}" {
	export * from "${h}/"
	
	export function ${qe}<Uri extends ${Wn}>(
		route: Uri | string & {},
		...args: Uri extends keyof ${Yt}
			? undefined extends RouteParams[Uri]
				? [params?: Record<string, string>, targetLangCode?: ${O}, routeLangCode?: ${O}]
				: [params: ${Yt}[Uri], targetLangCode?: ${O}, routeLangCode?: ${O}]
			: [params?: Record<string, string>, targetLangCode?: ${O}, routeLangCode?: ${O}]
	): string
	
	export function ${Xe}<Path extends ${Yn}>(
		path: Path | string & {},
		...args: undefined extends ${ot}[Path]
			? [options?: keyof ${ot} extends Path ? Record<string, unknown> : ${ot}[Path], langCode?: ${O}]
			: [options: ${ot}[Path], langCode?: ${O}]
	): string
	
	export function extractRouteLangCode(route: string): ${O} | undefined
	
	type ${Kt} = string | { [translationKey: string]: string | ${Kt} }
	type ${Jt} = { [langCode: string]: Record<string, ${Kt}> }
	type ${Wt} = { [langCode: string]: Record<string, string> }
	type ${rt} = (value: unknown, ...args: unknown[]) => string
	class ${Qe} {
		defaultLangCode: ${Et}
		supportedLangCodes: ${Ot}[]
		showDefaultLangCode: boolean
		translations: ${Jt}
		routeTranslations: ${Wt}
		get langCodes(): ${O}[]
		get langCode(): ${O}
		set langCode(langCode: ${O})
		get formatters(): Record<string, ${rt}>
		init(Astro: { url: URL }, formatters?: Record<string, ${rt}>): void
		addTranslations(translations: ${Jt}): void
		addRouteTranslations(routeTranslations: ${Wt}): void
		getFormatter(name: string): ${rt} | undefined
		setFormatter(name: string, formatter: ${rt}): void
		deleteFormatter(name: string): void
	}
	export const astroI18n: AstroI18n
}`;async function It(n,t,e=""){let r=(t==null?void 0:t.astroI18nConfig)||await V(n,e),o=(t==null?void 0:t.pagesMetadata)||J(n,r);y(r.translations,o.translations),p((0,Zt.join)(n,zt()),nr(r,(t==null?void 0:t.routes)||o.pages.map(i=>xt(i.route,r))))}function Zn(n,t=!1){let e=(0,Zt.join)(n,zt());if(t){p(e,`${Jn}
`);return}R(e)||p(e,`${Jn}
`)}function nr(n,t){return`${er(n)}
${rr(t)}
${sr(n.translations)}

${tr}
`}function er({defaultLangCode:n,supportedLangCodes:t}){let e=n?`type ${Et} = "${n}"
`:`type ${Et} = string
`;return e+=t.length>0?`type ${Ot} = "${t.join('" | "')}"
`:`type ${Ot} = string
`,[n,...t].filter(o=>!!o).length>0?`${e}type ${O} = ${Et} | ${Ot}`:`${e}type ${O} = string`}function rr(n){let t=`type ${Wn} = `,e=`type ${Yt} = {`;if(n.length===0)t+="string",e+="{ [uri: string]: undefined }";else{for(let r of n){t+=`| "${r}" `;let o=or(r);e+=`"${r}": ${ir(o)}; `}e+="}"}return`${t}
${e}`}function or(n){let t=[];for(let[e]of n.matchAll(/\/\[.+?](\/)?/g)){let r=Tt(e,"/[");r.endsWith("/")||(r+="/"),t.push(tt(r,"]/"))}return t}function ir(n=[]){return n.length===0?"undefined":`{ ${n.reduce((t,e)=>`${t}"${e}": string; `,"")}}`}function sr(n){let t=new Set,e={};nt(n,(s,{variant:a},f)=>{t.add(`"${s}"`),e[s]||(e[s]={properties:{}});for(let{name:c,default:u,formatters:g}of f){e[s].properties[c]={type:g.length>0?"unknown":"string",source:"interpolation",isOptional:!!u};for(let{arguments:T}of g)for(let m of T)!m.name||(e[s].properties[m.name]={type:"unknown",source:"argument"})}if(a.properties.length===0){e[s].hasDefaultVariant=!0;return}for(let{name:c,value:u}of a.properties)e[s].properties[c]={type:lt(u),source:"variant"}});let r=`type ${Yn} = `,o=`type ${ot} = `,i=Object.entries(e);if(t.size===0||i.length===0)return r+="string",o+="{ [path: string]: undefined | Record<string, unknown> }",`${r}
${o}`;r+=[...t].join(" | "),o+="{ ";for(let[s,{properties:a,hasDefaultVariant:f}]of i){let c=Object.entries(a);if(c.length===0){o+=`"${s}": {} | undefined; `;continue}let u="{ ",g=0;for(let[T,m]of c){if(m.source==="interpolation"&&m.isOptional||m.source==="variant"&&f){u+=`${T}?: ${m.type}; `,g+=1;continue}u+=`${T}: ${m.type}; `}u+=g===c.length?"} | undefined":"}",o+=`"${s}": ${u}; `}return o+="}",`${r}
${o}`}var Ht={name:"sync",options:[{name:"config",shortcut:"c"}]};async function Hn(n,t){var f;let e=n.at(0)??process.cwd();if(!e)throw S();let r=(0,it.resolve)(e,I()),o=((f=t.config)==null?void 0:f.at(0))&&(0,it.resolve)(e,t.config[0]);if(!$(r))throw N(r);let i=await V(e,o),s=J(e,i);y(i.translations,s.translations),y(i.routeTranslations,s.routeTranslations);let a=[];for(let c of s.pages){a.push(xt(c.route,i));for(let u of i.supportedLangCodes)Ct(s.directory,c.path,$t(c.path,u,i,it.posix.sep),c.hasGetStaticPaths,c.hasPrerender)}It(e,{astroI18nConfig:i,pagesMetadata:s,routes:a})}var qt=require("fs"),W=require("path");var qn=require("path");var Bn=`import { defineAstroI18nConfig } from "${h}"

export default defineAstroI18nConfig({
	defaultLangCode: "en",
	supportedLangCodes: [],
	showDefaultLangCode: false,
	translations: {},
	routeTranslations: {},
})`,ar=`const { defineAstroI18nConfig } = require("${h}")

module.exports = defineAstroI18nConfig({
	defaultLangCode: "en",
	supportedLangCodes: [],
	showDefaultLangCode: false,
	translations: {},
	routeTranslations: {},
})`,fr=`{
	"defaultLangCode": "en",
	"supportedLangCodes": [],
	"showDefaultLangCode: true,
	"translations": {},
	"routeTranslations": {}
}`,cr=new Set(["js","mjs","ts","mts"]),ur=new Set(["cjs","cts"]);function Xn(n,t="",e=!1){let r=t||(0,qn.join)(n,Rt(n)?`${l}.ts`:`${l}.js`);if(!(R(r)&&!e)){if(t){let o=U(t);if(cr.has(o)){p(t,Bn);return}if(ur.has(o)){p(t,ar);return}if(o==="json"){p(t,fr);return}throw new Error(`Unsupported extension ".${o}" ("${t}").`)}p(r,Bn)}}var st=require("path"),Qn=require("fs");var te=`..${st.sep}${k}${st.sep}${mt}`,pr=new RegExp(`/{3}(?: +)?<reference (?: +)?path=["'](${te})["'](?: +)?/>`),ne=`/// <reference path="${te}" />
`;function ee(n){Zn(n);let t=(0,st.join)(n,Kn());if(!R(t)){p(t,ne);return}let e=(0,Qn.readFileSync)(t,"utf8"),r=lr(e);e!==r&&p(t,r)}function lr(n){return L(pr,n)?n:`${n}
${ne}`}var wt=require("fs"),Bt=require("path");var gr=`import { defineConfig } from "astro/config"
import i18n from "${h}"

export default defineConfig({ integrations: [i18n()] })
`,mr=new Set(["mjs","mts"]),dr=new Set(["cjs","cts"]),yr=/(?:require(?:\s+)?\()|(?:module\.exports)/,hr=/(?:import )|(?:export default )/,Tr=/import\s+([\dA-Za-z]+)?,?(?:\s+)?({[^}]+})?(?:\s+)?from(?:\s+)?["'](.+)["']/g,xr=/(export default [^{]+{)(\s+)?([\S\s]+)/,Ar=/(?:const|var|let)\s+({[^}]+}|[\dA-Za-z]+)\s+=\s+require(?:\s+)?\((?:\s+)?["'`](.+)["'`]/g,$r=/(module\.exports|exports\.default[^{]+{)(\s+)?([\S\s]+)/,Cr=/(?:[\S\s]+)?integrations(?:\s+)?:(?:\s+)?\[(\s+)?/;function ie(n){var o,i;let t=Rr(n);if(!t){p((0,Bt.join)(n,Rt(n)?`${dt}.ts`:`${dt}.mjs`),gr);return}let e=(0,wt.readFileSync)(t,"utf8");if((Er(e,t)||"ESM")==="ESM"){let s=Or(e),a=(o=s[h])==null?void 0:o.default;if(a)return;a=re(s),e=oe("ESM",`import ${a} from "${h}"
${e}`,a)}else{let s=Ir(e),a=(i=s[h])==null?void 0:i.default;if(a)return;a=re(s),e=oe("CJS",`const { default: ${a} } = require("${h}")
${e}`,a)}p(t,e)}function Rr(n){let t=(0,wt.readdirSync)(n).filter(e=>ut(e)===dt).at(0);if(t){let e=(0,Bt.join)(n,t);return R(e)?e:void 0}}function Er(n,t=""){let e=U(t);if(mr.has(e))return"ESM";if(dr.has(e))return"CJS";if(hr.test(n))return"ESM";if(yr.test(n))return"CJS"}function Or(n){let t={},e=Ut(Tr,n);for(let{match:[,r,o,i]}of e){if(!i)continue;t[i]||(t[i]={}),r&&(t[i].default=r);let s=[];o&&(s=o.replace(/^{|}$/g,"").split(",").map(a=>a.split("as").map(f=>f.trim())));for(let[a,f]of s)t[i][a]=f||a}return t}function Ir(n){let t={},e=Ut(Ar,n);for(let{match:[,r,o]}of e){if(!r||!o)continue;if(t[o]||(t[o]={}),!r.startsWith("{")){t[o].default=r;continue}let i=r.replace(/^{|}$/g,"").split(",").map(s=>s.split(":").map(a=>a.trim()));for(let[s,a]of i){if(s==="default"){t[o].default=a;continue}t[o][s]=a||s}}return t}function re(n){let t=`${yt}_astro`;for(let e of Object.values(n))for(let[,r]of Object.entries(e))if(r===yt)return t;return yt}function oe(n,t,e){let r=L(n==="ESM"?xr:$r,t);if(!r)return n==="ESM"?`${t}
export default { integrations: ${e}() }`:`${t}
module.exports = { integrations: ${e}() }`;let{match:[,o,i,s],range:[a,f]}=r;return Mt(t,a,f,wr(e,o,i,s))}function wr(n,t,e,r){let o=L(Cr,r);if(!o)return`${t}${e||""}integrations: [${n}()],${e||""}${r}`;let{match:[i,s]}=o,a=r.replace(i,`${i}${n}(),${s||""}`);return`${t}${e||""}${a}`}var se={scripts:{"i18n:install":"astro-i18n install","i18n:sync":"astro-i18n sync","i18n:extract:keys":"astro-i18n extract:keys"}},Xt={name:"install",options:[{name:"config",shortcut:"c"}]};async function ae(n,t){var i;let e=n.at(0)??process.cwd();if(!e)throw S();let r=(0,W.resolve)(e,I()),o=((i=t.config)==null?void 0:i.at(0))&&(0,W.resolve)(e,t.config[0]);if(!$(r))throw N(r);Xn(e,o),ee(e),ie(e),Pr(e)}function Pr(n){let t=Sr(n);if(t){let r=F(t);if(!r)return;y(r,se,{mode:"fill"}),p(t,`${JSON.stringify(r,null,"	")}
`);return}let e=Nr(n);if(e){let r=F(e);if(!r)return;y(r,Lr(se),{mode:"fill"}),p(e,`${JSON.stringify(r,null,"	")}
`)}}function Sr(n){let t=(0,qt.readdirSync)(n).filter(e=>e.toLowerCase()===xn).at(0);if(t){let e=(0,W.join)(n,t);return R(e)?e:void 0}}function Nr(n){let t=(0,qt.readdirSync)(n).filter(e=>{let r=e.toLowerCase();return r===An||r===$n}).at(0);if(t){let e=(0,W.join)(n,t);return R(e)?e:void 0}}function Lr(n){let t={tasks:{}};for(let[e,r]of Object.entries(n.scripts))t.tasks[e]=`deno run npm:${r}`;return t}var at=require("path");var Qt={name:"sync:pages",options:[{name:"config",shortcut:"c"}]};async function fe(n,t){var a;let e=n.at(0)??process.cwd();if(!e)throw S();let r=(0,at.resolve)(e,I()),o=((a=t.config)==null?void 0:a.at(0))&&(0,at.resolve)(e,t.config[0]);if(!$(r))throw N(r);let i=await V(e,o),s=J(e,i);y(i.routeTranslations,s.routeTranslations);for(let f of s.pages)for(let c of i.supportedLangCodes)Ct(s.directory,f.path,$t(f.path,c,i,at.sep),f.hasGetStaticPaths,f.hasPrerender)}var tn=require("path");var nn={name:"sync:types",options:[{name:"config",shortcut:"c"}]};async function ce(n,t){var i;let e=n.at(0)??process.cwd();if(!e)throw S();let r=(0,tn.resolve)(e,I()),o=((i=t.config)==null?void 0:i.at(0))&&(0,tn.resolve)(e,t.config[0]);if(!$(r))throw N(r);It(e,void 0,o)}var le=require("path");var ue=require("fs"),Pt=require("path"),Dr=/.m?(?:ts|js|astro)$/,Fr=/import\s+(?:[\dA-Za-z]+)?,?(?:\s+)?{([^}]+t[\s,][^}]*)}?(?:\s+)?from(?:\s+)?["']astro-i18n["']/g;function pe(n,t){let e=jr(n);p((0,Pt.join)(t,hn),JSON.stringify(e,null,"	"))}function jr(n){let t={};return H(n,(e,r)=>{for(let o of e){if(!Dr.test(o))continue;let i=`${r}${Pt.sep}${o}`;if($(i,!1))continue;let s=(0,ue.readFileSync)(i,{encoding:"utf8"}),a=_r(s);if(!!a)for(let[,f]of s.matchAll(br(a)))f&&(t[f]=f)}}),t}function _r(n){let t=L(Fr,n);if(!(!t||t.match.length<2))for(let e of t.match[1].split(",")){let[r,o]=e.trim().split("as"),i=r.trim();if(i==="t")return(o==null?void 0:o.trim())||i}}function br(n){return new RegExp(`${n}\\((?:\\s+)?["']([\\s\\S]+?)["'](?:\\s+)?\\)`,"g")}var en={name:"extract:keys",options:[]};async function ge(n){let t=n.at(0)??process.cwd();if(!t)throw S();let e=(0,le.resolve)(t,I());if(!$(e))throw N(e);pe(`${t}/src`,`${t}/${k}`)}var rn={[Xt.name]:ae,[Ht.name]:Hn,[Qt.name]:fe,[nn.name]:ce,[en.name]:ge},{command:me,args:vr,options:Mr}=Dt([Xt,Ht,Qt,nn,en]);if(rn[me])rn[me](vr,Mr);else throw On(rn);
